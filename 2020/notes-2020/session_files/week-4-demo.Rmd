---
title: "Week 4 demo code"
output: html_notebook
---

## Use following four lines to practice dplyr

```{r}
library(conflicted)
library(tidyverse)
conflict_prefer("lag", "dplyr")
conflict_prefer("filter", "dplyr")
bank <- read.csv("https://goo.gl/PBQnBt", sep = ";")
options(dplyr.summarise.inform = FALSE)
```

## Different ways to use ggplot

```{r}
# pass data frame directly
ggplot(airquality) + geom_point(aes(Temp, Ozone))

# with pipe
airquality %>% ggplot(.) + geom_point(aes(Temp, Ozone))
```

## Use multiple geom_* functions.

```{r}
ggplot(bank, aes(age, balance)) + geom_point() + geom_smooth()
```

## Use different aes definition in different geom_* functions.

```{r}
ggplot(bank) + 
  geom_point(aes(age, balance, color = job)) +
  geom_smooth(aes(age, balance), inherit.aes = FALSE)
```

## use geom_line

```{r}
ggplot(bank) + geom_line(aes(age, balance))
```

```{r}
tibble(x = 1:100, y = rnorm(100)) %>% 
  ggplot(.) + geom_line(aes(x,y))

plot(x = 1:100, y = rnorm(100), type='l')
```

## Load your own data downloaded from AlphaVantage

```{r}
df_xle
df_xle %>% ggplot(.) + 
  geom_line(aes(timestamp, close)) +
  geom_point(aes(timestamp, high), color = "red", size = .5) +
  geom_point(aes(timestamp, low), color = "green", size = .5)
```

## 

```{r}
ggplot(bank) + geom_point(aes(age, job))

# distinct(bank, job, age) %>% nrow(.)

# rev(levels(factor(bank$job))) is equivalent to rev(sort(unique(bank$job)))

group_by(bank, job, age) %>% summarise(nn = n()) %>%
  ggplot(.) + geom_point(aes(age, job, size = nn)) +
  scale_y_discrete(limit = rev(levels(factor(bank$job))))
  # or, scale_y_discrete(limit = rev(sort(unique(bank$job))))
```

## Exercise 2 - use position nudge to shift the plots.

```{r}
group_by(bank, job, age, loan) %>% summarise(nn = n()) %>% 
  ggplot() +
  geom_point(data = . %>% filter(loan == "yes"), aes(age, job, size = nn), alpha = 0.5, color = 'red', position = position_nudge(y = -0.2)) +
  geom_point(data = . %>% filter(loan == "no"), aes(age, job, size = nn), alpha = 0.5, color = 'blue', position = position_nudge(y = 0.2))
```

## Create interactive plots with plotly

```{r}
g <- ggplot(bank) + geom_density(aes(age))

# install.packages("plotly")

library(plotly)

ggplotly(g)

# method 1
(ggplot(bank) + geom_density(aes(age))) %>% ggplotly()

# method 2
g <- ggplot(bank) + geom_density(aes(age))
ggplotly(g)
# str(g$data)
```


```{r}
ggplot(bank) + geom_point(aes(age, duration, color = education))

ggplot(bank) + geom_point(aes(age, duration)) +
  facet_grid(. ~ education)

ggplot(bank) + geom_point(aes(age, duration)) +
  facet_grid(. ~ job) + theme(text = element_text(size = 50))
```

```{r}
ggplot(bank) +
  geom_line(aes(x, y)) +
  scale_x_discrete() / scale_x_reverse() / scale_x_
  theme(text = element_text(size = 5))

```

https://ggplot2.tidyverse.org/reference/

geom_point
geom_line
geom_smooth
geom_density
geom_histogram
geom_bar












