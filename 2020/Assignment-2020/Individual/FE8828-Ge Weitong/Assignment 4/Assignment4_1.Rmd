---
title: "Exploratory Data Work for the bank dataset"
author: "Ge Weitong" 
date: "Oct 2020"
output: html_document
---

```{r setup, include=FALSE} 
library(tidyverse) 
library(dplyr) 
library(ggplot2)
library(ggthemes)
# Use echo = TRUE for assignment is an exception, so code is visible. 
knitr::opts_chunk$set(echo = TRUE, fig.align="center", collapse = TRUE, cache = TRUE) 
# bank <- read.csv("https://goo.gl/PBQnBt", sep = ";")
```
Most people have balance lower than 20000, regardless of their job sectors. And majority retired people are elderly but retired people do not own more balance than people who are still working. 

# Finding 1
```{r}
ggplot(bank, aes(job, balance, color = age)) + 
  geom_point() + 
  scale_colour_gradient(low="red", high="green") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```



# Finding 2
# plot the average bank balance for different ages
# From age 10 to 50, the bank balance slowly increse with age increases, and the difference of bank balance is small comaring to peers within same age group.
#After age 60 and above, the difference of bank balance is quite huge comaring to peers within same age group, for example, for age group 60-70,  the highest bank balance is >$10,000 while the lowest balance is <$1500.
```{r}

bank_age <- group_by(bank, age) %>%
summarise(balance_mean = mean(balance),
count = n(),
default_count = sum(ifelse(default == "no", 0, 1)))

knitr::kable(bank_age)

bank_age %>%
ggplot(aes(x = age, y = balance_mean)) +
geom_point(aes(size = count), alpha = 1/4, color = "red") +
geom_point(aes(size = default_count), alpha = 1/3, color = "blue") +
geom_smooth(se = FALSE)
```
#finding 3: Employment & Age

#Below plot shows age-group and employment type. for example, for age_group 30, majority are working as Blue-collar and management; 
#for age_group 60 and above, majority are retired.
```{r}
df <- bank %>%  #filter(balance > mean(balance)) %>%t
  group_by(age_group = (age %/% 10) * 10, job ) %>% summarise(n = n())
knitr::kable(df)

df %>%
ggplot(aes(x=age_group, y=job)) +
geom_point(aes(size = n), alpha = 1/4, color = "red")
geom_smooth(se = FALSE)

df %>%
ggplot(aes(x = age_group, y = education)) +
geom_point(aes(size = n), alpha = 1/4, color = "red") +
geom_point(aes(size = default_count), alpha = 1/3, color = "blue") +
geom_smooth(se = FALSE)
```


Most people do not subscripbe, regardless of their job sectors. And management people have the highest subscription ratio. 
# Finding 4
```{r}
ggplot(bank) + geom_bar(mapping = aes(x = job, fill = y))
```


Mean of balance dosen't differ much among different age groups. Mean of balances slighly increse with increase of age. Elderly People older than 40 tend to maintain more balance.
# Finding 5
```{r}
df <- mutate(bank, age_group = case_when(
  age < 20 ~ "<20",
  age < 30 ~ "20-30",
  age < 40 ~ "30-40",
  age < 50 ~ "40-50",
  age < 60 ~ "50-60",
  TRUE ~ "60+"
)) %>%
  arrange(age_group)
ggplot(df, aes(age_group, balance)) + geom_boxplot()
```


More people tend to get married with increase of age. For age > 50, majority people are married or divorsed, few people are still single. Between 30-40, the count of single people is highest.
# Finding 6

```{r}
ggplot(bank, mapping = aes(x = age, fill = marital)) + geom_histogram()
```


