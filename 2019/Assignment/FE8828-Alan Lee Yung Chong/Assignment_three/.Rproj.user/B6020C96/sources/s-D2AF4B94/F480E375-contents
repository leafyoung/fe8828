---
title: "Bank Data Analysis"
author: "Alan Lee (G1900405J)"
date: "21/9/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)
library(bizdays)
library(dplyr)
library(ggplot2)
knitr::opts_chunk$set(echo = TRUE, fig.align="center", collapse = TRUE, cache = TRUE)
bank <- read.csv("https://goo.gl/PBQnBt", sep = ";")
```

## R Markdown Exercise
The following document is for exploratory dataset for the bank dataset used in lesson 3 of FE8828: Programming Web Application in Finance. The following report will include 10 data exploratory insights from the dataset. Hopefully find something interesting.

```{r, echo=FALSE}
summary(bank)
```

### How do the distribution of the balance data differ across different jobs?

Finding 1: We wish to investigate the balance's descriptive statistics segmented by jobs. From the summary statistics, we see that retired individual has the highest average balance followed by housemaids, management and entrepreneur.

```{r, echo=FALSE}

df_1 <- bank %>% group_by(., job) %>% summarise(avg_balance = mean(balance), max_balance=max(balance), 
                                        min_balance = min(balance), var_balance=(sd(balance)), count = n()) %>% arrange( desc(avg_balance))

barplot(df_1$avg_balance, main="Distribution of average balance in bank by jobs", xlab="Jobs", ylab="Balance", names.arg=df_1$job, col="gold", border=FALSE)
```

### Does education affects the amount of balance in bank?

Finding 2: We wish to confirm if having higher education means having higher paying jobs, for this particular dataset, we see that the individual having the highest balance in the bank are management who only has primary school education.
```{r, echo=FALSE}
`%notin%` <- Negate(`%in%`)
bank %>% group_by(job, education)%>% dplyr::filter(education !="unknown"  & job %notin% c("unemployed","retired", "unknown", "housemaid") ) %>% summarise(avg_balance = mean(balance), max_balance=max(balance), min_balance = min(balance), var_balance=(sd(balance)), count = n()) %>% arrange(desc(avg_balance)) 
```

### Among the customers with loans, do they on average have a lower balance in bank due to higher debt and default more frequently?

Finding 3: We wish to discover if the customers with loans on housing have lower balance in bank due to higher debt and default more frequently. We see that people with no loans, no housing, and no record of default usually has good credit character and has higher average balance in the bank account.

```{r, echo=FALSE}
bank %>% group_by(loan, housing, default)%>% summarise(avg_balance = mean(balance), var_balance=(sd(balance)), count=n()) %>% arrange(desc(avg_balance)) 
```

### How does the mid career individual grouped by jobs differ in the bank balance in the bank? 

Finding 4: We try to see if there is a pattern using scatterplot with different colors in age category between the balance and the duration in the management profession.

```{r, echo=FALSE}
df4 <- bank %>% mutate(.,age_group=case_when(age<30 ~ "young",
                                   age>=30 & age < 45 ~ "mid career",
                                   age>=45 & age < 60 ~ "late career",
                                   age>=60 ~ "senior citizen")) %>% filter(age_group == "mid career")%>% group_by(job) %>% summarize(median_balance =                                                 median(balance), count=n())  %>% arrange(desc(median_balance))
barplot(df4$median_balance, main="Distribution of median balance among the mid career individual", xlab="Jobs", ylab="Balance", names.arg=df_1$job, col="light green", border=FALSE)
# plot scatterplot 
```

### What are the break down of proportion of jobs young people with more than $500 balance in bank holds? 

Finding 5: for individual still in the early career what is the breakdown of the jobs? we see that mostly are housemaids, admin and self-employed individual. 

```{r, echo=FALSE}
df4 <- bank %>% mutate(.,age_group=case_when(age<30 ~ "early career",
                                   age>=30 & age < 45 ~ "mid career",
                                   age>=45 & age < 60 ~ "late career",
                                   age>=60 ~ "senior citizen"))

early <- df4 %>% filter(age_group=="early career" & balance>=500) %>% group_by(job) %>% summarize(count=n())
# middle<-df4 %>% filter(age_group=="mid career") %>% group_by(job) %>% summarize(count=n())
# late<-df4 %>% filter(age_group=="late career") %>% group_by(job) %>% summarize(count=n())
# senior<-df4 %>% filter(age_group=="senior citizen") %>% group_by(job) %>% summarize(count=n())


pie( table(early$count), xlab="Early Career, people less than 30 y/o, with more than $500 in savings", label=early$job, main="Breakdown of Jobs")
# pie( table(middle$count), xlab="Mid Career more than 30 y/o, less than 45 y/o", label=early$job)
# pie( table(late$count), xlab="Late Career", labels="Late Career")
# pie( table(senior$count), xlab="Senior Citizen", labels="Senior Citizen")

plot.new()
```
### What are the break down of proportion of jobs late career people with more than $3000 balance in bank holds? 

Finding 6: for individual with more than $3000 late stage of the career what is the breakdown of the jobs? we see that more individual are in the management role, followed by housemaids and entrepreuer filling the majority of the job.

```{r, echo=FALSE}
df4 <- bank %>% mutate(.,age_group=case_when(age<30 ~ "early career",
                                   age>=30 & age < 45 ~ "mid career",
                                   age>=45 & age < 60 ~ "late career",
                                   age>=60 ~ "senior citizen"))

late_c <- df4 %>% filter(age_group=="late career" & balance>=3000 & job!="unknown") %>% group_by(job) %>% summarize(count=n())

pie( late_c$count, xlab="Late Career, people older than 45 y/o and younger than 65 y/o", label=late_c$job, main="Breakdown of Jobs")

```

### In marketing campaign, who should the bank target for new credit card for loyalty package? 

Finding 7: Bank wish to deduce who to target for marketing campaign for new credit card for those who is married, over 30 years old, have housing and no loans and duration more than a year, which individual they need to get into contact to update contact infomation? We see that over 1/3 of the customer entitled to new credit card needs to be contacted through other means to inform them of their special priviledge.

```{r, echo=FALSE}
df7 <- bank %>% filter(marital=="married"& age>=30 & housing=="yes" & loan=="no"& duration>365)%>% group_by(contact) %>% summarize(count=n())

pie( df7$count, xlab="Loyalty credit card entitled customer", label=df7$contact, main="Medium of contact")
```
### Does the month of joining as the member correlates with the balance in the bank?

Finding 8: We see that customer joining in the month of december tends to have higher balance in the bank after a year. And those who joined in July tends to have the lowest balance.
```{r, echo=FALSE}
df8 <- bank %>% filter(duration>365) %>% group_by(month) %>% summarize(avg_balance=median(balance), count=n()) %>% arrange(desc(avg_balance))

barplot(df8$avg_balance, main="Month of joining the bank and median balance", xlab="Month of joining the bank", ylab="Median balance", names.arg=df8$month, col="sky blue", border=FALSE)
```
### What proportion of people's maritial status are over 40  yet has housing?

Finding 9: See charts
```{r, echo=FALSE}
df9 <- bank %>% filter(age>40 & housing=='yes') %>% group_by(marital) %>% summarise(count = n()) %>% arrange(desc(count))

pie( df9$count, xlab="Marital Status of those with housing", label=df9$marital, main="Marital Status Proportion")

# barplot(df9$count, main="Marital Status Proportion", xlab="Marital Status of those with housing", ylab="Frequency", names.arg=df9$marital, col="yellow", border=FALSE)
```
### Which group of people most likely owns the bank money?

Finding 10: Most risky group of people are displayed as in chart
```{r, echo=FALSE}
`%notin%` <- Negate(`%in%`)
df10 <- bank %>% filter(balance < 0) %>% group_by (job, education, marital) %>% summarize(count=n()) %>% arrange(desc(count)) %>% mutate(category =                                                                                                 paste0(paste0(paste0(paste0(job,", ")),education, ", "), marital)) %>% filter(count>=15)

barplot(df10$count, main="High chance of default", xlab="", ylab="count in data", names.arg=df10$category, col="red", border=FALSE)
pie( df10$count, xlab="Which category of people has high change of owning the bank money?", label=df10$category, main="High chance of default")

```
