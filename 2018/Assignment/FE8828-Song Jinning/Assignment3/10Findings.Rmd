---
title: "Assignment3"
author: "Song Jinning"
date: "2018/11/26"
output: html_document
---

```{r setup}
library(tidyverse) 
library(lubridate) 
library(bizdays)
# Use echo = TRUE for assignment is an exception, so code is visible. knitr::opts_chunk$set(echo = TRUE, fig.align="center", collapse = TRUE, cache = TRUE) 
bank <- read.csv("https://goo.gl/PBQnBt", sep = ";")
```
# Finding #1
This data contains 4521 rows, 17 columns, which includes 16 predictor variables and 1 output variable.
```{r}
dim(bank)
colnames(bank)
```
# Finding #2
Among the clients, the age group with largest number of people is 30-40. 
```{r}
# Find the big age group 
bank %>%
group_by(age_group = (age %/% 10) * 10) %>% summarise(count = n()) %>% arrange(age_group) -> res
res
plot(res$age_group, res$count) 
```
# Finding #3
Except those retired, among these occupations, housemaids have the highest average age, and students have the lowest average age. The difference between the average ages of people doing other jobs are small.
```{r}
df3<- group_by(bank, job) %>% summarize(avg_age=mean(age), min_age=min(age), max_age=max(age))%>%arrange(avg_age, min_age, max_age)
df3
```
# Finding #4
On average, people with tertiary education level have more money in their accounts. However, the one with most balance has primary education level. And as compared to people with secondary education, those with primary education level always have more money in their accounts. This might be due to they don't know how to manage their wealth.
```{r}
df4 <- group_by(bank, education) %>% summarize(avg_balance=mean(balance), median_balance=median(balance), max_balance=max(balance), min_balance=min(balance))
df4
```
# Finding #5
On average, the clients who have defaulted before have -209 euro balance, and 56.6% of them have negative balance.
```{r}
df5 <- group_by(bank, default) %>% summarise(count=n(),avg_balance=mean(balance), nega_balance=sum(balance<0)) %>% mutate(percentage= nega_balance/count*100)
df5
```

# Finding #6
If the previous marketing campaign is successful, the percentage of success for this marketing campaign is 64.3%, which is 3-6 times higher as compared to other outcomes.
```{r}
df6 <- group_by(bank, poutcome) %>% summarise(count=n(),yes=sum(y=="yes"))%>% mutate(percentage= yes/count*100)
df6
```
# Finding #7
Older people use cellular less, and use telephone more.
```{r}
df7 <- group_by(bank, age_group = (age %/% 10) * 10) %>% summarise(cellular=sum(contact=="cellular"),telephone=sum(contact=="telephone"))%>% mutate(cel_tele_ratio=cellular/telephone)
df7
plot(df7$age_group,df7$cel_tele_ratio)
```
# Finding #8
In total, only 11.524% of the clients subscribed for a term deposit.
```{r}
df8<- bank %>% group_by(y) %>% summarize(n = n()) %>% mutate(percentage = n/sum(n)*100)
df8
```
# Finding #9
Among the successful telemarketing cases, most clients agreed to subscribe for the term deposit when the bank contacted them for the first time during this campaign. As the number of contacts increased, the number of successful cases decreased.
```{r}
# Normalize the data
df9 <- group_by(bank, campaign) %>% summarise(yes=sum(y=="yes")/n())
df9
plot(df9$campaign,df9$yes)
```
# Finding #10
In terms of bio and financial variables, clients with age 20- and 60+, retired or student, single or divorced, without loan and with higher balance in their accounts are more likely to subscribe for a term deposit.
```{r}
df10 <- group_by(bank, age_group = (age %/% 10) * 10) %>% summarise(count=n(),yes=sum(y=="yes"))%>% mutate(percentage = yes/count*100) %>% arrange(desc(percentage))
df11 <- group_by(bank, job) %>% summarise(count=n(),yes=sum(y=="yes"))%>% mutate(percentage = yes/count*100) %>% arrange(desc(percentage))
df12 <- group_by(bank, marital) %>% summarise(count=n(),yes=sum(y=="yes"))%>% mutate(percentage = yes/count*100) %>% arrange(desc(percentage))
df13 <- group_by(bank, loan) %>% summarise(count=n(),yes=sum(y=="yes"))%>% mutate(percentage = yes/count*100) %>% arrange(desc(percentage))
df14 <- group_by(bank, balance_group = (balance %/% 500) * 500) %>% summarise(count=n(),yes=sum(y=="yes"))%>% dplyr::filter(yes>3) %>% mutate(percentage = yes/count*100) %>% arrange(desc(percentage))
# removing the groups with very small sample size, <=3
plot(df14$balance_group, df14$percentage)
```