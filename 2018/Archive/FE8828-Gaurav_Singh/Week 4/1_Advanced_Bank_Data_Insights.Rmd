---
title: "Bank Data insights - Week 4 Assignment"
author: "Gaurav Singh"
date: "December 3, 2018"
output: html_document
---

```{r setup, include=FALSE}
library(kableExtra)
library(tidyverse)
library(ggthemes)
knitr::opts_chunk$set(echo = TRUE,warning=FALSE,fig.align = "center")
```

# Problem  : Bank Data Stories

```{r definition,echo=FALSE,message=FALSE}
bank<-read.csv("https://goo.gl/PBQnBt",sep=";") %>%
mutate(Slnum=1:n())
cat(paste("Brief about the Data: It has "),nrow(bank)," rows.")
```

---
## Insight #1 - Age Distribution of the sample - with custom percentile
```{r run1,message=FALSE}
  custom_quartiles<-quantile(bank$age, prob = c(0.15, 0.85))
  bank %>%
  group_by(age) %>% 
  summarise(freq=n()) %>%
  ggplot(aes(x=age,y=freq)) + 
  geom_line()+
  xlab("Age") +
  ylab("Frequency")+
    geom_vline(xintercept=custom_quartiles,linetype="dashed", color = "red")
```

### The Sample is fairly young as seen. 75% sample is between Age 31 - 53 as seen by red percentile lines.

## Insight #2 - Age Distribution Job Wise
```{r run2,message=FALSE}
  ggplot(bank, aes(x = reorder(job,age, FUN = median), y = age)) +
    geom_boxplot() +
    theme(axis.text.x=element_text(angle=90, hjust=1)) +
    xlab("Jobs") +
    ylab("Age")

  ggplot(bank) +
    geom_bar(
      mapping = aes(x = age, fill = job),
      position = "fill",
      colour="grey"
      )

```

###Note: The Student group has lowest median and the retired group has the largest as expected.
###Blue-collar, Technician, Management and Admin form the major chunk of the middle-aged sample.


## Insight #3 - Marital Status Across Age
Defaulter distribution against Jobs is :
```{r run3,message=FALSE}
  bank %>%
  group_by(marital,age) %>%
  ggplot(aes(fill=marital, y=marital, x=age)) + 
  geom_bar( stat="identity") +
  theme(axis.text.x=element_text(angle=90, hjust=1)) +
  xlab("Age") +
  ylab("Marital")

  bank %>%
  group_by(marital,age) %>%
  ggplot() + 
  geom_bar(
    mapping = aes(fill=marital, x=age),
      position = "fill",
      colour="grey"
  ) +
  theme(axis.text.x=element_text(angle=90, hjust=1)) +
  xlab("Age") +
  ylab("Marital")
```

###The sample seems to lose their freedom rapidly in the 30s
###Some start reclaiming their independence, but most of them end up married.

## Insight #4 - Education distribution against Jobs
Education distribution against Jobs is :
```{r run4,message=FALSE}
  bank %>% 
  group_by(job) %>% 
  summarize(
    Primary=sum(ifelse(education=="primary",1,0)),
    Secondary=sum(ifelse(education=="secondary",1,0)),
    Tertiary=sum(ifelse(education=="tertiary",1,0)),
    Unknown=sum(ifelse(education=="unknown",1,0))
    ) %>%
  kable() %>%
  kable_styling()

bank %>%
  group_by(job,education) %>%
  summarise(count=n()) %>%
  ggplot(aes(fill=education, y=count, x=job)) + 
  geom_bar( stat="identity") +
  theme(axis.text.x=element_text(angle=90, hjust=1)) +
  xlab("Jobs") +
  ylab("Count")

bank %>%
  group_by(job,education) %>%
  summarise(count=n()) %>%
  ggplot(aes(fill=education, y=count, x=job)) + 
  geom_bar( stat="identity",position="fill",color="grey") +
  theme(axis.text.x=element_text(angle=90, hjust=1)) +
  xlab("Jobs") +
  ylab("Count")
```

###The story from the above two graphs are:
#.  Management and Technician are jobs with mostly higher education and medium education respectively
#.  Jobs with maximum education level in general:
    #. Primary - Housemaid
    #. Secondary - Services
    #. Tertiary - Management

## Insight #5 - Marital status across Jobs
```{r run5,message=FALSE}
  bank %>%
  group_by(marital,job) %>%
  ggplot(aes(fill=marital, y=marital, x=job)) + 
  geom_bar( stat="identity") +
  theme(axis.text.x=element_text(angle=90, hjust=1)) +
  xlab("Job") +
  ylab("Marital")

  bank %>%
  group_by(marital,job) %>%
  ggplot() + 
  geom_bar(
    mapping = aes(fill=marital, x=job),
      position = "fill",
      colour="grey"
  ) +
  theme(axis.text.x=element_text(angle=90, hjust=1)) +
  xlab("Job") +
  ylab("Marital")
```
###The story from the above two graphs are:
#.  Management sees the most Divorces
#.  Students are the most happy lot - Single!
#.  Most married people by number are of Blue-Collar proffession


## Insight #6 - Default across Marital status 
```{r run6,message=FALSE}
  bank %>%
  group_by(marital,default) %>%
  ggplot(aes(fill=default, y=default, x=marital)) + 
  geom_bar( stat="identity") +
  theme(axis.text.x=element_text(angle=90, hjust=1)) +
  xlab("Job") +
  ylab("Marital")

  bank %>%
  group_by(marital,default) %>%
  ggplot() + 
  geom_bar(
    mapping = aes(fill=default, x=marital),
      position = "fill",
      colour="grey"
  ) +
  theme(axis.text.x=element_text(angle=90, hjust=1)) +
  xlab("Marital") +
  ylab("Defauly")
```

###The story from the above two graphs are:
#.  Most People are married
#.  Divorced group has the largest contribution to default group


## Insight #7 - Balance across Jobs and Age
```{r run7,message=FALSE}
ggplot(bank, aes(age, balance)) + geom_point(aes(color = job)) +
geom_smooth() +
facet_wrap(.~job, nrow = 3)
```

###The story from the above two graphs are:
#.  Balance increases in Blue-Collar and Management.
#.  Unemployed and retired show a marked decrese in balance as expected.
#.  A few outliers are observed in the sample for balance across jobs


## Insight #8 - 
```{r run8,message=FALSE}
ggplot(bank, aes(age, balance)) + geom_point(aes(color = job)) + ylim(-20000,30000)+
geom_smooth()  +
facet_wrap(loan  ~ housing, nrow = 2)
```

###The story from the above two graphs are after removing a few ouliers.
#.  No definite swing in bank balance with increase in age, across varying combination of home & personal loan
#.  People taking any type of loan are generally under age 50

## Insight #9 - Most Contacted Job Group this campaign
```{r run9,message=FALSE}
ggplot(bank, aes(balance, campaign)) + geom_point(aes(color = job)) +xlim(-1000,20000)+
geom_smooth() +
    theme(axis.text.x=element_text(angle=90, hjust=1)) +
facet_wrap(.~job, nrow = 3)
```
###Most contacted groups are Blue-Collar and Management.

## Insight #10 - Conversion to term deposit with respect to duration of call
```{r run10,message=FALSE}
 bank %>%
  group_by(duration,y) %>%
  summarize(count=n()) %>%
  ggplot(aes(fill=y, y=count, x=duration)) + 
  geom_bar( stat="identity") +
  theme(axis.text.x=element_text(angle=90, hjust=1)) + xlim(0,1200)+
  xlab("Job") +
  ylab("Marital")

   bank %>%
  group_by(duration,y) %>%
  summarize(count=n()) %>%
  ggplot(aes(fill=y, y=count, x=duration)) + 
  geom_bar( stat="identity",position="fill") +
  theme(axis.text.x=element_text(angle=90, hjust=1)) + xlim(0,1200)+
  xlab("Job") +
  ylab("Marital")
```

###The story from the above two graphs are:
#.  Calls less than 5 mins (or 300 secs) most likely to not convert into a term deposit
#.  Calls more than 5 mins more likely convert to term deposit

## Legend
```{r legend, echo=FALSE,message=FALSE}
cat(paste("Brief about the Data Columns:"))
description<-c("age (numeric)",
"job : type of job (categorical: 'admin.','blue-collar','entrepreneur','housemaid','management','retired','self-employed','services','student','technician','unemployed','unknown')",
"marital : marital status (categorical: 'divorced','married','single','unknown'; note: 'divorced' means divorced or widowed)",
"education (categorical: 'basic.4y','basic.6y','basic.9y','high.school','illiterate','professional.course','university.degree','unknown')",
"default: has credit in default? (categorical: 'no','yes','unknown')",
"housing: has housing loan? (categorical: 'no','yes','unknown')",
"loan: has personal loan? (categorical: 'no','yes','unknown')# related with the last contact of the current campaign:",
"contact: contact communication type (categorical: 'cellular','telephone') ",
"month: last contact month of year (categorical: 'jan', 'feb', 'mar', ..., 'nov', 'dec')",
"duration: last contact duration, in seconds (numeric). Important note: this attribute highly affects the output target (e.g., if duration=0 then y='no'). Yet, the duration is not known before a call is performed. Also, after the end of the call y is obviously known. Thus, this input should only be included for benchmark purposes and should be discarded if the intention is to have a realistic predictive model.",
"campaign: number of contacts performed during this campaign and for this client (numeric, includes last contact)",
"pdays: number of days that passed by after the client was last contacted from a previous campaign (numeric; 999 means client was not previously contacted)",
"previous: number of contacts performed before this campaign and for this client (numeric)",
"poutcome: outcome of the previous marketing campaign (categorical: 'failure','nonexistent','success')",
"y - has the client subscribed a term deposit? (binary: 'yes','no')")
data.frame(SlNo=c(1:15),Column_Description=description) %>%
  kable() %>%
  kable_styling()
```


