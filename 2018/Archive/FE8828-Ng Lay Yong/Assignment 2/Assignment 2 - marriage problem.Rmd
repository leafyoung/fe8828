---
title: "Assignment 2"
author: "Ng Lay Yong"
date: "November 8, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(error =TRUE)
```

# Marriage Problem
### Problem Outline

The marriage problem, also known as the secretary problem or sultan's dowry problem, involves the optimal stopping theory. The problem is outlined below:

Assume a King grants a prince a chance to marry one of his princesses, the prince will be presented with the daughters one at a time and he needs to decide which princess is the best. He is allowed to split the group of princesses into 2, an observation group and a selection group. However, he can **only** select the **best princess** in the **selection group**. This means that if the best princess is in the observation group, he would have failed in his attempt to marry the best princess. 

Therefore, how should the prince split the group such that the probability of marrying the best princess is the highest?

### Coding For Loops to find best split number with highest probability for 100 princesses

Based on research and simulations that others have done (Honsberger 1979, pp. 104-110, Mosteller 1987; Havil 2003, p. 136), the highest probability (around 37.1%) is achieved when the prince has seen at least 37 princesses in the observation group. Thus, let's first generate for loops for 100 princesses, with 37 princesses in the observation group and 63 princesses in the selection group and we can use the probability generated to check if our code is correct.

##### 1. Sample list of princesses
First sample 100 princesses and arrange them randomly. All princesses are numbered from 1 to 100 with princess 100 being the best princess.

##### 2. Split into observation group and selection group
Next split the group into observation group (list of 37 elements) and selection group (list of 63 elements).

##### 3. Find the maximum observation
Find the maximum observation in the observation group

##### 4. Compare maximum observation with selection group
Next compare the maximum observation with the selection group. If the princess's number is greater than another princess's number in the selection group, break out of the program and record this maximum number of the princess selected.

##### 5. Count number of successful selections
If the princess chosen in the selection group is indeed the best princess (number 100), add 1 to the total count of successful selections.

##### 6. Compute probability of successful selection
The probability of the successful selection is calculated by dividing the total counts of successful selections by the number of simulation runs.

### Code for 10 runs below

The code below prints out the observation lists and selections lists so that the programmer can check to see if the simulation is right before proceeding to code for higher runs.

```{r ForLoop}
count<-0
runs<-10
for(j in 1:runs){
  N<-100
  list<-sample(1:N,N, replace = FALSE)
  obs_list<-list[c(1:37)]
  select_list<-list[-c(1:37)]
  print("This is the observation list:")
  print(obs_list)
  print("This is the selection list:")
  print(select_list)
  max_obs<-max(obs_list)
  print("This is the best princess in the observation group")
  print(max_obs)
  if(max_obs == N){max_select<-0}
    for(i in select_list){
      if(max_obs != N){
      if(i < max_obs){
        next
      }else{
        if(i>max_obs){
          print("Princess chosen in selection group")
            max_select<-i
            print(max_select)
            break
                
        }else{
          max_select<-0
            break
          }
        }
    }}
  if(max_select==N & max_select %in% select_list){
    count<-count+1
    print("Number of best princesses picked so far")
    print(count)
  }else{
    count<-count+0
  }
    }
prob<-count/runs
print(paste0("Probability of successfully picking the best princess is ", prob))

```
### Code for 100 runs without printing lists

We can see from the probability below that it ranges between 0.3 to 0.4, which is close to the probability of around 0.371 found in other studies.
```{r}
count<-0
runs<-100
for(j in 1:runs){
  N<-100
  list<-sample(1:N,N, replace = FALSE)
  obs_list<-list[c(1:37)]
  select_list<-list[-c(1:37)]
  max_obs<-max(obs_list)
  if(max_obs == N){max_select<-0}
    for(i in select_list){
      if(max_obs !=N){
      if(i < max_obs){
        next
      }else{
        if(i>max_obs){
            max_select<-i
            break
      }else{
            max_select<-0
            break
          }
        }
    }}
  if(max_select==N & max_select %in% select_list){
    count<-count+1
  }else{
    count<-count+0
  }
 }   
prob<-count/runs
print(paste0("Probability of successfully picking the best princess is ", prob))
print(prob)
```
### Create make_choice function to decide on best split

We can now proceed to create a function to split the group from 1 to 100 and plot the probability distribution over the split numbers.

```{r}
count<-0
runs<-10000
make_choice<-function(N,split_number){
for(j in 1:runs){
  list<-sample(1:N,N, replace = FALSE)
  obs_list<-list[c(1:split_number)]
  select_list<-list[-c(1:split_number)]
  max_obs<-max(obs_list)
  if(max_obs == N){max_select<-0}
  for(i in select_list){
    if(i < max_obs){
      next
    }else{
      if(i>max_obs){
        max_select<-i
        break
      }else{
        max_select<-0
        break
      }
    }
  }
  if(max_select==N & max_select %in% select_list){
    count<-count+1
  }
}

prob<-count/runs
}
probability<-vector(mode="numeric",length=99)
for(i in 1:99){
  probability[i]<-make_choice(100,i)
}
data.frame(probability)
max(probability)
plot(probability, main = "Probability of marrying best princess", xlab = "Split number", ylab = "Probability")
```

### Comment on result

We can see from the distribution that the highest probability (around 0.37) of marrying the best princess is when the split number is between 35 to 40.

### Coding to find expectation for each split number

Let's find the average value of the princess given a split number. In this scenario, if the best princess is in the observation group, the prince will select the last princess in the selection group. This is because by the time he has finished comparing all the princesses in the selection group with his "benchmark princess" in the observation group, he would have no choice but to accept the last princess as his bride.

The split number shall start from zero here. If split number is zero, it means that he doesn't have a chance to pick a benchmark princess and he would straightaway select the first princess in the selection pile. This is the same as picking one princess randomly from selection group of 100.

```{r}
make_choice<-function(N,split_number){
    list<-sample(1:N,N, replace = FALSE)
    obs_list<-list[c(1:split_number)]
    select_list<-list[-c(1:split_number)]
    max_obs<-max(obs_list)
    for(i in select_list){
      if(max_obs == N){
        max_select<-select_list[N-split_number]#select last princess if best princess already in observation group
        break
      }else{
        if(i < max_obs){
          next
        }else{
          if(i>max_obs){
            max_select<-i
            break
          }
        }
              }
         }
 
  best<-max_select #this line of code seems redundant but is actually necessary for input into res vector later
}

res<-vector(mode="numeric",length=N)
res0<-vector(mode="numeric",length=N)
splitres<-vector(mode="numeric",length=N)

#Run code for split numbers 1 to 99
for(i in 1:99){
  for(j in 1:10000){
res[j]<-make_choice(100,i)
res0[j]<-sample(1:100,1)
  }
  #Result for split_number = 0 stored in first element of res vector
  splitres[1]<-mean(res0)
  #Result for subsequent split numbers stored in from second element of res vector onwards
  splitres[i+1]<-mean(res)
}
#change x axis from 1:100 to 0:99
x_split<-c(0:99)
df_result<-cbind(x_split,splitres)
df_result
max(splitres)
plot(df_result, main = "Expectation of princess vs split number", xlab = "Split number", ylab = "Expectation")

```

### Comment on result

We can see from the distribution above that the highest expectation is around 91 when the split number is between 7 to 15. When the split number is zero, the expectation is around 50 which is expected since the mean of 100 is 50 and we are just randomly choosing a princess among 100. 

### Discussion of results

The distribution of the expectation graph is different from the distribution of the previous probability graph and it seems to suggest 2 different best split numbers for marrying the best princess. However, one needs to keep in mind that the objective of the 2 simulations are different. 

In the first simulation, we are trying to find the highest probability of selecting the best princess given a split number. Therefore, if the objective of the prince is to select the best princess, he would be better off using the split number given in the first simulation, which is to have about 35 to 40 princesses in the observation group.

In the second simulation, we are trying to find the highest expectation of the princess given a split number. Therefore, if the objective of the prince is to marry any one of the top 10 princesses (does not have to be the best), he would stand a better chance by having between 7 to 15 princesses in the observation group.

### Conclusion
In conclusion, the prince should have 7 to 15 princesses in the observation group if he wants to marry any of the top princesses. If he wants to marry the best princess only, he should have 35 to 40 princesses in his observation group.