---
title: "FE8828 Assignment for ggplot Exploratory Data Analysis"
author: "Liu Zhe"
date: "Dec 3, 2017"
output: html_document
---
```{r setup, include=FALSE}
library(tidyverse)
library(ggplot2)
library(knitr)
knitr::opts_chunk$set(echo = TRUE, fig.align="center", collapse = TRUE, cache = T)
bank <- read.csv("https://goo.gl/PBQnBt", sep = ";")

```

# Finding #1
Those who subscribed a term deposit spent longer duration (higher mean of "duration") on the last call of contact. It could be either they are interested to know more about bank's services, or they get convinced by salesmen when the call duration is long
```{r Finding1, echo = TRUE}
fun_mean <- function(x){
  mean(x) %>%
  data.frame(y=.,label=mean(x,na.rm=T))}

ggplot(bank, aes(y, duration)) + geom_boxplot() + geom_point() +
  stat_summary(fun.y = mean,geom = "point", colour="blue", size=3) + 
  stat_summary(fun.data=fun_mean, geom="text", vjust= -0.5)
```

# Finding #2
The age group of 60s, 70s and 80s have higher call duration compared with younger people: A possible reason is that elder people are more generous with their time (blue point is the mean value of the group)
```{r Finding2, echo = TRUE, warning = FALSE}
AgeGrpTable <- mutate(bank, AgeGroup = (age %/% 10) * 10)
ggplot(AgeGrpTable, aes(AgeGroup, duration, group = AgeGroup)) + geom_point() + geom_boxplot() +
  stat_summary(fun.y = mean,geom = "point", colour="blue", size=3)
```

# Finding #3
Based on the 2 findings above, can we say that >60s (Senior) people are more likely to subscribe a term deposit, since they prefer to spend longer time on the call? <br /> <br />
Well, from the plot below, it is possibly true. At least, part of the reason why Senior people are more likely to subscribe a term deposit is simply that, it is easier to get them stay on the phone
```{r Finding3, echo = TRUE}
mutate(AgeGrpTable, Senior = ifelse(AgeGroup >= 60, "Senior", "Not Senior Yet")) %>% 
  ggplot(.) + geom_bar(mapping = aes(x=Senior, fill=y), position = "fill") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

# Finding #4
For the previous campaign in which the outcome is already known ("success" or "failure"), Technicians contributed to the most cases of success, followed by Management and Admin; The job of "Unknown" did not contribute many cases of success, but it has highest ratio of success at ~62%. <br /> <br />

Furthermore, there are 32 "unknown" people who had never been contacted for marketing campaigns yet (pday == -1). If the bank tries to approach them at 62% success rate, then it can expect another 20 clients successfully involved in its next marketing campaign. <br /> <br />

Similar approach can be applied to other occupations, by filtering out pday == -1 people, and utilizing current success ratio data to estimate total expected number of new clients in next marketing campaign.
```{r Finding4, echo = TRUE}
g4 <- dplyr::filter(bank, poutcome == "failure" | poutcome == "success") %>%
  rowwise() %>% mutate(haveOutcome = "Have Outcome") %>% ungroup()
ggplot(g4) + geom_bar(aes(x= job, fill = poutcome)) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(g4) + geom_bar(aes(x= job, fill = poutcome), position = "fill") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

dplyr::filter(bank, pdays == -1 & job == "unknown") %>% summarize(UnknownCount = n())
```

# Finding #5
Tried to check the working force's bank account balance trend wrt their age. Out of the 7 occupations, there are interesting findings on "management" and "entrepreneur": <br /> <br />
1st plot is for "management", and they have obviously higher saving almost across their entire career compared to other occupations. <br /> <br />
2nd plot is for "entrepreneur", and they have higher volatility of saving account, possibly due to the natural risk from their activity of running big business. <br /> <br />
3rd plot is a summary of all occupation's account balance trending. Black smooth line is the overall trend. <br /> <br />

```{r Finding5, echo = TRUE, warning = FALSE}
EmployTable <- mutate(bank, employment = ifelse(job == "admin." | job == "blue-collar" | job == "entrepreneur" |job == "management" |job == "self-employed" |job == "services" |job == "technician", "Employed", "No Job"))
WorkingForce <- dplyr::filter(EmployTable, employment == "Employed")

ggplot(WorkingForce) +
  geom_point(aes(x = age, y = balance)) +
  geom_smooth(data = dplyr::filter(WorkingForce, job == "management"),
              aes(x = age, y = balance), color = "green", method = "loess") +  
  geom_smooth(data = dplyr::filter(WorkingForce, job != "management"), 
              aes(x = age, y = balance), color = "black", method = "loess") +
  ylim(-1000, 10000)

ggplot(WorkingForce) +
  geom_point(aes(x = age, y = balance)) +
  geom_smooth(data = dplyr::filter(WorkingForce, job == "entrepreneur"),
              aes(x = age, y = balance), color = "yellow", method = "loess") +  
  geom_smooth(data = dplyr::filter(WorkingForce, job != "entrepreneur"), 
              aes(x = age, y = balance), color = "black", method = "loess") +
  ylim(-1000, 10000)

ggplot(WorkingForce) +
  geom_point(aes(x = age, y = balance)) +
  geom_smooth(data = dplyr::filter(WorkingForce, job == "admin."),
              aes(x = age, y = balance), color = "red", method = "loess") +
  geom_smooth(data = dplyr::filter(WorkingForce, job == "blue-collar"),
              aes(x = age, y = balance), color = "orange", method = "loess") +
  geom_smooth(data = dplyr::filter(WorkingForce, job == "entrepreneur"),
              aes(x = age, y = balance), color = "yellow", method = "loess") +
  geom_smooth(data = dplyr::filter(WorkingForce, job == "management"),
              aes(x = age, y = balance), color = "green", method = "loess") +
  geom_smooth(data = dplyr::filter(WorkingForce, job == "self-employed"),
              aes(x = age, y = balance), color = "turquoise", method = "loess") +
  geom_smooth(data = dplyr::filter(WorkingForce, job == "services"),
              aes(x = age, y = balance), color = "purple", method = "loess") +
  geom_smooth(data = dplyr::filter(WorkingForce, job == "technician"),
              aes(x = age, y = balance), color = "blue", method = "loess") +
  geom_smooth(data = WorkingForce, aes(x = age, y = balance), color = "black", method = "loess") +
  ylim(-1000, 10000) 
```


# Finding #6
The rate of divorce does not change with education level. However, it looks that the chance of being single gets higher when one receives higher level education.
```{r Finding6, echo = TRUE}
ggplot(bank) + geom_bar(mapping = aes(x=education, fill = marital), position = "fill") + coord_flip()
```

# Finding #7
For the well-educated (tertiary) working force, if they are single, then they are less likely to work as technicians at their middle age of 40-50s. Most will step into management positions. <br /> <br />
In comparison, for married people, after getting 50s, the number of technicians is almost as high as before 40s. <br /> <br />
1st plot is for single and 2nd is for non-single. Both plots only consider tertiary-educated working force.<br /> <br />
3rd & 4th plot show the ratio of married/single technicians and management across different ages. It is clearly seen that, at the age near 50, there is very little chance to find single technicians, but for managers, 1 out of 4 are still single. <br /> <br />
It could be interpreted in an interesting way that, managers are financially stronger (from Finding #5) and dare to stay single even if they are at their middle age, while technicians do not dare to. <br /> <br />


```{r Finding7, echo = TRUE}
dplyr::filter(WorkingForce, education =="tertiary" & marital =="single") %>%
ggplot(.,aes(age, color = job, fill = job)) + geom_histogram(binwidth = 1)

dplyr::filter(WorkingForce, education =="tertiary" & marital !="single") %>%
ggplot(.,aes(age, color = job, fill = job)) + geom_histogram(binwidth = 1)

dplyr::filter(WorkingForce, education =="tertiary" & job == "technician" & marital != "divorced") %>%
  ggplot(.) + geom_bar(mapping = aes(x = age, fill = marital),position = "fill")
dplyr::filter(WorkingForce, education =="tertiary" & job == "management" & marital != "divorced") %>%
  ggplot(.) + geom_bar(mapping = aes(x = age, fill = marital),position = "fill")
```

# Finding #8
Whether clients are employed or not does not have a major impact on their bank account balance; Anti-intuitively, the working force's mean of balance is roughly $200 lower than mean of those who currently do not have a job.
```{r Finding8, echo = TRUE}



ggplot(EmployTable, aes(x = employment, y = balance)) + geom_boxplot() +
  stat_summary(fun.y = mean,geom = "point", colour="blue", size=3) + 
  stat_summary(fun.data=fun_mean, geom="text", vjust= -0.5)

```


# Finding #9
Whether clients are employed or not totally does not imply whether their balance is positive or negative; The ratio of having negative balance is always ~16%
```{r Finding9, echo = TRUE, warning = FALSE}
PositivityTable <- mutate(EmployTable, Positivity = ifelse(balance >0, "positive balance", "negative balance"))
ggplot(PositivityTable) + geom_bar(aes(x = employment, fill = Positivity), position = "fill") 
```

# Finding #10
For bank account balance, a possible reason of why those who do not have a job can even perform better than those who have a job is that: Retired people have higher saving than their junior working force...<br /> <br />
It's true. It is found that retired people have higher balance & lower chance of negative balance than working force ("Employed"). Also, after "retired" people are taken out from the "No Job" group, the "No Job" group average bank account balance has a significant fall of $200, and becomes lower than that of Employed people.
```{r Finding10, echo = TRUE}
dplyr::filter(PositivityTable, job != "retired") %>% 
  ggplot(., aes(x = employment, y = balance)) + geom_boxplot() +
  stat_summary(fun.y = mean,geom = "point", colour="blue", size=3) + 
  stat_summary(fun.data=fun_mean, geom="text", vjust= -0.5)

g10 <- mutate(PositivityTable, newEmployment = ifelse(job == "retired", "retired", employment))
  ggplot(g10, aes(x = newEmployment, y = balance)) + geom_boxplot() +
  stat_summary(fun.y = mean,geom = "point", colour="blue", size=3) + 
  stat_summary(fun.data=fun_mean, geom="text", vjust= -0.5)

ggplot(g10) + geom_bar(aes(x = newEmployment, fill = Positivity), position = "fill") 
```
