---
title: "ggplot"
author: "zeven"
date: "2017??12??3??"
output: html_document
---
#Using bank data to setup
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(bizdays)
library(ggplot2)
library(dplyr)
library(DT)
bank <- read.csv("https://goo.gl/PBQnBt", sep = ";")
option <- read.csv("https://dl.dropboxusercontent.com/s/tjdqficcpothzeq/datazeven.csv?dl=0", header = TRUE, sep=",")
knitr::opts_chunk$set(echo = TRUE, fig.align="center", collapse = TRUE, cache = TRUE)
```

```{r dataProcess, echo=TRUE}
numTotal <-nrow(option)
IDSeq<- seq(1,numTotal)
DateGenerateSeq<- rep(as.Date("2017-11-24"),numTotal)
underlyingSeq<-rep("AMZN",numTotal)
optionPriceSeq <-select(option,Price)
positionSeq<-rep("Long",numTotal)
Callseq<-rep("temp",numTotal)
Callseq[1:87]<-"call"
Callseq[88:174]<-"put"
#Callseq
ExpdateSeq<- rep(as.Date("2018-01-18"),numTotal)
StockPriceSeq<- rep(1186,numTotal)
StrikePriceSeq<- select(option,Strike)
VolumeSeq<- select(option,OpenInt)
DataTable<-data.frame(
  No =IDSeq,
  ExtractionDate = DateGenerateSeq,
  Underlying =underlyingSeq,
  StockPrice =StockPriceSeq,
  OptionPrice = optionPriceSeq,
  StrikePrice = StrikePriceSeq,
  Position = positionSeq,
  Quantity = VolumeSeq,
  CallorPut = Callseq
)
names(DataTable)[8] <- c("Quantity") #change header
#head(DataTable)
```

### R Markdown
####The following study is performed by using data of AMZN's option price in assignment 3.2
```{r OptionPrice, echo=TRUE}
#calltable<- dplyr::filter(DataTable,CallorPut=="call")
g<-ggplot(DataTable)
g+geom_point(aes(Strike,Price,color =Price))+
  geom_smooth(aes(Strike,Price),method = "lm")+
  facet_grid(.~CallorPut)+labs(title = "Option price with respect to strike price")+ 
  xlab("Strike Price") + 
  ylab("Option Price")

```

##Fig.1 This figure shows the call and put option price with respect to its strike price of AMZN using the data with extraction date of 2017/11/24 from google finance. The plot figure is grouped by 2 types of option: call and put. 


```{r priceRange, echo=TRUE}
#calltable<- dplyr::filter(DataTable,CallorPut=="call")
callPut <- ungroup((dplyr::filter(DataTable, !is.na(Price)) %>%
rowwise() %>% 
mutate(Value = Price*Quantity)))
summary<-group_by(callPut, CallorPut) %>% 
  summarize(TotalOpitonValue = sum(Value))
ggplot(callPut,aes(CallorPut,Value,color = CallorPut))+geom_boxplot()
```

##Fig.2 This figure shows the range of call or put option price with the underlying of AMZN using boxplot. From this figure, we can conclude that the price range of call option is much larger than put option with the same range of strike price.

###The following figure are derived by analysis on bank data
```{r price, echo=TRUE,warning= FALSE}
library(MASS)
p<- ggplot(bank)
p +geom_point(aes(age,balance,color = job))+theme(legend.position="right")+ scale_y_log10() 
```

##Fig.3 This figure plots clients' balance with respect to their age, filled with different colors as from different categories of jobs.


```{r JobCount, echo=TRUE,warning= FALSE}
#summary<-group_by(bank,job) %>% 
#  summarize(TotalBalance = sum(balance))
#summary
#p<-ggplot(summary)
bar <- ggplot(data = bank) + 
  geom_bar(
    mapping = aes(x = job, fill = job), 
    show.legend = FALSE,
    width = 1
  ) + 
  theme(aspect.ratio = 1) +
  labs(x = NULL, y = NULL)

bar + coord_flip()
bar + coord_polar()
```

##Fig4.These 2 figures show the numbers and ratios of clients from different job categories. From the plots we can conclude that the number of clients who work as technician, management or entrepreneur are comparatively more likely to deposit their money in bank than people doing other jobs; while student, housemaid and entrepreneur seldomly deposit in bank.

```{r AgebyJob, echo=TRUE}
g<-ggplot(bank)
g+ geom_point(aes(age,balance))+
  geom_smooth(aes(age,balance))+
  facet_wrap(~job,nrow =4)
```

##Fig.5 This figure plots the balance with respect to age grouping by job categories. By using "loess" method to draw a smooth line on each plot, we can observe the change of average balance with respect to age of people from different job categories. The conclusion is that only people who work in area of management of services tend to deposit more in bank, others don't have significant change in deposit.


```{r mariageDefault, echo=TRUE,warning= FALSE}
#bank2<-dplyr::filter(bank,default=="yes") 
ggplot(bank)+
geom_bar(mapping = aes(x=marital,fill = default),
         width = 0.4,position = "fill")+coord_flip()
```

##Fig.6 This figure plots the number of default with respect to marital status of clients. From this figure, we conclude that those who are divorced have a higher possibility of defaulting; while those who are married are least likely to default.

```{r MarritalJob, echo=TRUE,warning= FALSE}
#bank2<-dplyr::filter(bank,default=="yes") 
ggplot(bank)+
geom_bar(mapping = aes(x=job,fill = marital),width = 0.4,position = "fill")+ 
  theme(axis.text.x = element_text(size = 10, 
                                   family = "myFont", face = "bold",
                                   vjust = 0.5, hjust = 0.5, angle = 45))
```

##Fig.7 This figure plots the number of clients' marital status according to their job categories. From the figure, we conclude that except students, those who work in technician, admin and management department have a comparatively high single rate. And those who are retired or unemployeed have the highest divorce rate.

```{r agePlot, echo=TRUE,warning= FALSE}
#bank2<-dplyr::filter(bank,default=="yes") 
ggplot(bank,aes(age,color = job,alpha = 0.5))+geom_density(aes(fill=job))
```

##Fig.8 This figure plots the density of age of clients from different job areas. From the figure above, we conclude that the average age of student is the smallest and most concentrated, and the average age of retired clients are the largest.

```{r composite, echo=TRUE}
ggplot(data = bank,mapping = aes(reorder(job,age,FUN = median),fill = marital))+geom_bar()+
  scale_x_discrete(limit =
                     levels(reorder(bank$job,bank$age,FUN =  median)))+
  geom_line(aes(x = job,y = age))+
  geom_point(data = group_by(bank,job)%>%
               summarize(age = median(age))%>% ungroup,
             aes(x= job,y=age),inherit.aes = FALSE)+  
  theme(axis.text.x = element_text(size = 10,face = "bold",vjust = 0.5, hjust = 0.5, angle = 45))+
  xlab("Job sorted by median age")
```

##Fig.9 This figure plots the marital status according to different job categories, and the x-axis is sorted according to members' median age.

```{r group2, echo=TRUE}
ggplot(bank) + geom_point(mapping = aes(balance, duration,color = age))+
  facet_wrap(marital~education,nrow = 3)
```

##Fig.10 This figure plots the duration with respect to balance grouping by different marital status and educational background, colored by clients' age. From the figures, we conclude that clients who are single and with secondary educational background have the longest average duration.