---
title: "R Notebook"
output: html_document
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

#1. read the data from desktop
```{r 1 }
calculation <- read.csv("Documents/NTU MFE/Miniterm 3/WebPrograming/assignment_3/Assignment_3_rawdata.csv", header=T, stringsAsFactors = F)
```

#2. count the total value of call alone, put alone, call and put.
```{r 2 }
mutate(calculation, Value=OptionPrice*Quantity)->optioncalculation
summarise(dplyr::filter(optioncalculation,Type=="Put"), TotalPutValue=sum(Value))
summarise(dplyr::filter(optioncalculation,Type=="Call"), TotalCallValue=sum(Value))
summarise(optioncalculation, Total_Value=sum(Value))
```
#3. find those in the money
```{r 3}
library(dplyr)
mutate(calculation, Payoff=ifelse(StockPrice<Strike,0,StockPrice-Strike)) %>%
  filter(.,Payoff>=0) %>%
  nrow(.)
```

#4. plot the volatility curve, strike vs volatility (implied volatility)
#in this question, my R studio can not use the function of GBSVolatility, even after installing fOption.

```{r 4}
library(ggplot2)
library(dplyr)
mutate(calculation, Period=as.numeric(as.Date(ExpiryDate, format="%d-%b-%y")-as.Date(ExtractionDate, format="%d-%b-%y"))/365) %>% 
  mutate(., optiontype=ifelse(Type=="Put","p","c")) %>% 
  select(., optiontype, OptionPrice, Strike, StockPrice,Period) %>% 
  rowwise(.) 
  newoption <- mutate(., ImpliedVolity=GBSVolatility(price=OptionPrice, TypeFlag=optiontype, S=StockPrice, X=Strike, Time=Period, r=0.01, b=0, tol=0.005, maxiter=100000)) 

ggplot(newoption) + 
  geom_point(data=filter(newoption, type=="p"), aes(Strike, ImpliedVolity), color="yellow") +
  geom_point(data=filter(newoption, type=="c"), aes(Strike, ImpliedVolity), color="red") 

```

